{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Pages — Catalog</title>

  <!-- Bootstrap CSS (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="" crossorigin="anonymous">

  <!-- Your custom CSS (keeps look & feel) -->
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>
  <!-- Bootstrap navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="{% url 'catalog' %}">AI Pages</a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navCollapse" aria-controls="navCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navCollapse">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="{% url 'cart' %}">
              <svg xmlns="http://www.w3.org/2000/svg" class="me-1" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                <path fill="currentColor" d="M7 4h-2l-1 2H2v2h2l3.6 7.59-1.35 2.45A1 1 0 0 0 7 19h12v-2H8.42c-.14 0-.25-.08-.31-.2L9.1 15h7.45a1 1 0 0 0 .92-.62l2-5A1 1 0 0 0 19.55 8H7.21l-.94-2zM10 20a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"></path>
              </svg>
              <span class="">Cart</span>
              <span id="cart-badge" class="badge bg-teal text-white ms-2">0</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    {% if messages %}
      <div class="container mt-3">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="row mb-3">
      <div class="col">
        <h1 class="h3 mb-1">Discover books</h1>
        <p class="text-muted mb-0">Buy once — we email you the external link(s). Fast checkout with Paystack.</p>
      </div>
    </div>

    <!-- Bootstrap grid for cards -->
    <div id="book-grid" class="row g-3">
      {% for book in books %}
      <div class="col-12 col-sm-6 col-md-4 col-lg-3">
        <article class="card h-100 book-card" tabindex="0"
                 data-id="{{ book.id }}"
                 data-title="{{ book.title|escapejs }}"
                 data-author="{{ book.author|default_if_none:''|escapejs }}"
                 data-price-kobo="{{ book.price_kobo }}"
                 data-link="{{ book.link_url|escapejs }}">
          <div class="cover-wrap">
            {% if book.cover %}
              <img class="cover img-fluid" src="{{ book.cover.url }}" alt="{{ book.title }}">
            {% else %}
              <div class="cover placeholder d-flex align-items-center justify-content-center">
                <span class="placeholder-text">No image</span>
              </div>
            {% endif %}
          </div>

          <div class="card-body d-flex flex-column">
            <h5 class="card-title mb-1 title">{{ book.title }}</h5>
            {% if book.author %}<p class="card-subtitle mb-2 text-muted small">By {{ book.author }}</p>{% endif %}
            <p class="price mb-3">₦<span class="price-value" data-kobo="{{ book.price_kobo }}">loading...</span></p>

            <div class="mt-auto d-flex gap-2">
              <button class="btn btn-outline-secondary view-details flex-grow-1" type="button">View</button>
              <button class="btn btn-primary add-to-cart" type="button">Add to cart</button>
            </div>
          </div>
        </article>
      </div>
      {% endfor %}
    </div>
  </main>

  <!-- Bootstrap-based product modal (replacement for custom modal) -->
<div class="modal fade" id="product-modal" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" role="document">
      <div class="modal-body p-3">
        <button type="button" class="btn-close float-end" data-bs-dismiss="modal" aria-label="Close"></button>

        <div class="d-flex gap-3 flex-wrap">
          <div class="modal-cover" style="flex:0 0 42%;">
            <img id="modal-cover-img" src="" alt="" class="img-fluid rounded">
          </div>

          <div class="modal-info" style="flex:1 1 55%;">
            <h2 id="modal-title" class="h5 mb-1">Title</h2>
            <p id="modal-price" class="price fw-bold mb-3">₦0.00</p>
            <p id="modal-link" class="text-muted small">We email the external link after payment</p>

            <div class="modal-actions mt-3 d-flex gap-2">
              <button id="modal-add" class="btn btn-primary">Add to cart</button>
              <a id="modal-cart" class="btn btn-outline-secondary" href="{% url 'cart' %}">Go to cart</a>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>


  <!-- Bootstrap JS (Popper + Bootstrap) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="" crossorigin="anonymous"></script>

  <!-- Your existing JS (keep main.js, includes cart + modal hook) -->
  <script src="{% static 'js/main.js' %}"></script>
</body>
</html>
